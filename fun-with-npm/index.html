<!DOCTYPE html>
<html>
  <head>
    <title>"Fun" with NPM</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="styles.css"/>
  </head>
  <body>
    <textarea id="source">

class: center, middle

# NPM 

Some review and an interesting problem

by Harold Vilander

???
<!-- Link consumption example ![who cares][1] -->
[1]: https://blog.logrocket.com/why-you-should-use-package-lock-json
[2]: https://docs.npmjs.com/cli/v7/configuring-npm/package-json#peerdependencies
[3]: https://semver.org
[4]: https://docs.npmjs.com/cli/v6/commands/npm-install
[5]: https://docs.npmjs.com/cli/v6/commands/npm-ci
[6]: https://stackoverflow.com/questions/18875674/whats-the-difference-between-dependencies-devdependencies-and-peerdependencies
[7]: https://stackoverflow.com/questions/11207638/advantages-of-bundleddependencies-over-normal-dependencies-in-npm?lq=1
[8]: https://docs.npmjs.com/downloading-and-installing-packages-globally
[9]: https://github.com/npm/npx
[10]: https://docs.npmjs.com/cli/v6/configuring-npm/package-lock-json


---

- Two Files

- Install Commands

- Dependency "Types" 

- Some Tools

- A Recent Issue 


???
- the two files that define our dependencies
- a review of the install commands
- a review of dependency types
- some tools for understanding what is happening / trouble shooting


- A lot of this will be review, but things I had forgot
- local package testing: how to put something like sqform into your team project  
  - docker and non-docker setups
-  An interesting issue I ran across, that had no errors but the resulting CSS was
  wonky

---
# Two files
- `package.json`
- `package-lock.json`

???
- package.json defines your dependencies and lots of other things about your project
- package-lock describes the exact versions installed
  - "A manifestation of the manifest" [10]
  - generated when npm modifies `node_modules` or package.json
  - a way to get a reproducible build with the nature of continuous deployments

---

- `npm install`
  - `package.json` -> node_modules/
  - will update package-lock.json conditionally

- `npm install <pkg name>`
  - `--save-prod` or `-P`
  - will update your package.json
  - will also update your package-lock.json

???
- with no arguments
  - condition: if the package.json was newer version than the lock
- install package name: 
 - default to --save-prod, updates package.json FOR YOU AND lock file
---

- `npm install <name>@<version>`
- `npm install <name> --save-dev` or `npm install <name> -D`
    - puts an entry in devDependencies 
- `npm ci`
???
- installs specific version (or version range, `^`) see the docs for more info
- updates the devDependencies section of package.json, will also update the package lock
- CI is continuous integration mode. 
 - meant for automated environments
 - "OR any situation where you want to make sure you have a clean install of deps"
 - if package.json and package-lock.json don't agree it will not update package-lock
 - KEY DIFFERENCE ^^^ I expected to work when manually updating package.json
 - will remove node modules if they are present.

---


# AND MORE! 
- global -> npx
- github, tar file, folder path, etc

???

- global:  using packages on your computer, docs[8] say use npx instead if 5.2 or greater
- can install from file, path, github, bitbucket, and lots of other options [4]
  - git repo installs should be a method of last resort like just testing 
  - in previous work we relied on this and it was very problematic.


---

# Dependency "Types"
- `dependencies`
- `devDependencies`
- `peerDependencies`

???
- dependencies
  - npm install from a dir that has a package.json
  - npm install $package etc
- devDependencies
 - also installed from package.json unless you `--production` 
 - not installed for npm install package unless you flag --dev
 - not installed transitively
- peerDependencies
  - this changes in v7,
  - we are on v6 ...after v7 peers should install automatically
  - unless there is a conflict that cannot auto resolve

---

# More Types

- `bundledDependencies`
- `optionalDependencies`


???

Last two we don't really use
- bundled [7] - new to me, There is a link to a Stack OF...
  use when private npm package, you don't want to create your own npm repository
  but want some of the benefits of npm packages
- optional: npm should continue with the install, generally for packages that
  don't work in every environment

---
 
# tools 

- `npm list mymodule`
- `grep version node-modules/my-module/package.json`
- `npm pack`
- `npm run build`
- local package consumption - testing

???

---

# The Issue
- Working on testing out the TS branch of SQForm
- The issue
- css out of order
- css duplicated!!! 

---

Part 2: trouble shooting
- demo:
Show duplicate via list

- some trouble shooting that might be useful


---

Part 3: solution hunting
- local consumption
- I no longer trust NPM with its lock
- peer dependencies?

---
  semver:  Semantic Versioning 2.0.0
  1. MAJOR version when you make incompatible API changes,
  2. MINOR version when you add functionality in a backwards compatible manner, and
  3. PATCH version when you make backwards compatible bug fixes.
Additional labels for pre-release and build metadata are available as extensions to the MAJOR.MINOR.PATCH format.


---
Holder
??? intro text 
I have been having some fun doing some version updates, trying to consume typescript branch of 
sqforms inside of miav. 

I had a fun error to figure out. 

I have found local consumption of our libs very useful

npm tools:
- list
- peer dependencies
- doing update installs: nuke the lock 
- maybe a better way: recomended useage


`npm install` no arguments:
- install the dependencies to the local node_moduels folder.
- looks to the dependencies listed in package.json

`-g` flag: global
installs the current package context (ie the current working dir) as
a global package

`global package`  



ooh interesting
npm install <alias>@npm<name> - installs a package under a cumtom alias
npm install [<@scope/]<name>@<version>

global

Default: false
Type: Boolean
Operates in "global" mode, so that packages are installed into the prefix folder instead of the current working directory. See folders for more on the differences in behavior.

packages are installed into the {prefix}/lib/node_modules folder, instead of the current working directory.
bin files are linked to {prefix}/bin
man pages are linked to {prefix}/share/man

    </textarea>
    <script src="https://remarkjs.com/downloads/remark-latest.min.js">
    </script>
    <script>
      var slideshow = remark.create();
    </script>
  </body>
</html>
